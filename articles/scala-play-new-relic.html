<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="icon shortcut" href="http:/./localhost:8000./favicon.png"/><link rel="stylesheet" href="https:/./fonts.googleapis.com./css2?family=Inter:wght@400;600;700&amp;display=swap"/><script>window.twttr=(function(f,b,g){var e,c=f.getElementsByTagName(b)[0],a=window.twttr||{};if(f.getElementById(g)){return a}e=f.createElement(b);e.id=g;e.src="https:/./platform.twitter.com./widgets.js";c.parentNode.insertBefore(e,c);a._e=[];a.ready=function(d){a._e.push(d)};return a}(document,"script","twitter-wjs"));<./script><title>Scala + Play on HerokuなWebアプリにNew Relicを導入のプレビュー<./title><meta name="next-head-count" content="6"/><link rel="preload" href="../_next./static./css./2235a6460a19405f0647.css" as="style"/><link rel="stylesheet" href="../_next./static./css./2235a6460a19405f0647.css" data-n-g=""/><noscript data-n-css=""><./noscript><link rel="preload" href="../_next./static./chunks./main-1b66b3d4e760501de7fc.js" as="script"/><link rel="preload" href="../_next./static./chunks./webpack-101b4f64d52887b5db9b.js" as="script"/><link rel="preload" href="../_next./static./chunks./framework.c81d3c1a1154ef2f0a4c.js" as="script"/><link rel="preload" href="../_next./static./chunks./commons.1d17d07e0ebe7c16f5b5.js" as="script"/><link rel="preload" href="../_next./static./chunks./pages./_app-b342a0da64871712e09b.js" as="script"/><link rel="preload" href="../_next./static./chunks./7ea9eb72fe501167df0c2d045178d60d280aa121.549ac0d8bdc0604fb58b.js" as="script"/><link rel="preload" href="../_next./static./chunks./fac796102cd92fcc9d69418a1184140a0c3193c8.fee5f3964bb5b2c71f69.js" as="script"/><link rel="preload" href="../_next./static./chunks./pages./articles/[slug]-ed1dc9d6a24fac085414.js" as="script"/><./head><body><div id="__next"><div class="main-container"><div class="main-sidebar"><aside class="sidebar"><header class="sidebar-header"><a class="sidebar-logo-link" href="http:/./localhost:8000/"><img src="../logo.svg" alt="Zenn Editor" width="160" height="19"/><./a><a href="https:/./github.com./zenn-dev./zenn-editor" class="sidebar-github-link"><img src="../github.svg" alt="GitHub" width="22" height="22"/><./a><./header><div class="sidebar-collections"><details class="sidebar-collection" open=""><summary class="sidebar-collection__title">articles<./summary><ul class="sidebar-collection__ul"><li class="sidebar-collection__li"><a class="sidebar-nav-item " title="./articles./268447da9fb103.md" href="268447da9fb103.html">🏹 <span class="draft">下書き<./span>Swift Bow Archの入門<./a><./li><li class="sidebar-collection__li"><a class="sidebar-nav-item " title="./articles./54134d8df9f9b5385fc3.md" href="54134d8df9f9b5385fc3.html">📄 Zennの記事をGitHub Pagesで無理やり表示する<./a><./li><li class="sidebar-collection__li"><a class="sidebar-nav-item " title="./articles./79c6c48226166aa0e875.md" href="79c6c48226166aa0e875.html">🙈 <span class="draft">下書き<./span>量子コンピュータで“Covert”⁉️なガチャ<./a><./li><li class="sidebar-collection__li"><a class="sidebar-nav-item active" title="./articles./scala-play-new-relic.md" href="scala-play-new-relic.html">📈 Scala + Play on HerokuなWebアプリにNew Relicを導入<./a><./li><./ul><./details><details class="sidebar-collection" open=""><summary class="sidebar-collection__title">books<./summary><ul class="sidebar-collection__ul"><li class="sidebar-collection__li"><a class="sidebar-nav-item " title="undefined.md" href="http:/./localhost:8000/">✨ 最初の本を作成しましょう<./a><./li><./ul><./details><./div><a href="https:/./zenn.dev./dashboard./uploader" class="sidebar-external-link" target="_blank" rel="noopener noreferrer"><img src="https:/./twemoji.maxcdn.com./2./svg/\1f4f7.svg" width="16" height="16"/>画像のアップロード<./a><a href="https:/./zenn.dev./zenn./articles./markdown-guide" class="sidebar-external-link" target="_blank" rel="noopener noreferrer"><img src="https:/./twemoji.maxcdn.com./2./svg/\1f58b.svg" width="16" height="16"/>マークダウン・ガイド<./a><a href="https:/./zenn.dev./zenn./articles./zenn-cli-guide" class="sidebar-external-link" target="_blank" rel="noopener noreferrer"><img src="https:/./twemoji.maxcdn.com./2./svg/\1f4bb.svg" width="16" height="16"/>CLIコマンド・ガイド<./a><./aside><button class="main-sidebar__minimize"><img src="../chevron.svg" alt="" width="22" height="22"/><./button><./div><main class="main-content"><article><div><header class="content-header"><div class="content-wrapper"><h1 class="content-header__title">Scala + Play on HerokuなWebアプリにNew Relicを導入<./h1><div class="content-header__row"><span class="content-header__row-title">slug<./span><span class="content-header__row-result">scala-play-new-relic<./span><./div><div class="content-header__row"><span class="content-header__row-title">emoji<./span><span class="content-header__row-result"><span style="font-size:20px">📈<./span><./span><./div><div class="content-header__row"><span class="content-header__row-title">topics<./span><span class="content-header__row-result"><span class="content-header__topic">scala<./span><span class="content-header__topic">playframework<./span><span class="content-header__topic">newrelic<./span><span class="content-header__topic">heroku<./span><./span><./div><div class="content-header__row"><span class="content-header__row-title">published<./span><span class="content-header__row-result">✅（公開）<./span><./div><div class="content-header__row"><span class="content-header__row-title">type<./span><span class="content-header__row-result">tech<!-- -->（技術記事）<./span><./div><a href="https:/./zenn.dev./zenn./articles./zenn-cli-guide" class="content-header__link" rel="noopener noreferrer" target="_blank">記事の作成方法 →<./a><./div><./header><div class="content-wrapper"><div style="margin:40px 0"><div class="znc"><h1 id="%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><a class="header-anchor-link" href="scala-play-new-relic.html#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB" rel="nofollow"><./a> はじめに<./h1>
<p><a href="https:/./www.heroku.com/" rel="nofollow">Heroku<./a>の無料（Hobby）範囲内で<a href="https:/./newrelic.com/" rel="nofollow">New Relic<./a>を無料で利用することができる。New Relicはアプリケーションのモニタリングツールであり、メモリ量やGCのことや外部APIアクセスのレスポンスタイムなど様々なデータをモニターすることができる。下記のようにグラフィカルな表示もしてくれる。<./p>
<ul>
<li><img src="https:/./storage.googleapis.com./zenn-user-upload./bj6lp9yck5kdimaywa4bl9eoxxri" alt=""><./li>
<li><img src="https:/./storage.googleapis.com./zenn-user-upload./mi2nwn2b7kdwbue90c0kfzphv0gi" alt=""><./li>
<./ul>
<p><a href="https:/./docs.newrelic.com./docs./agents./java-agent./installation./include-java-agent-jvm-argument/#Installing_on_Play" rel="nofollow">New Relicの公式のドキュメント<./a>にはJARファイルをいったんZIP展開したうえで、そこにYAMLファイルを設置して再びJARに戻すといった手順が紹介されているが、実はそのようなことをしなくても<code>build.sbt<./code>などへの記述 + 環境変数の追加だけで導入することができる。この記事ではHerokuを前提にNew Relicをどのように導入するかについて解説する。<br>
この記事で紹介したコードを利用したプログラムが下記のリポジトリーに設置されている。<./p>
<ul>
<li><a href="https:/./github.com./y-yu./kindle-clock" rel="nofollow">https:/./github.com./y-yu./kindle-clock<./a><./li>
<./ul>
<h1 id="1.-new-relic%E3%81%AE%E6%83%85%E5%A0%B1%E3%82%92%E5%85%A5%E6%89%8B"><a class="header-anchor-link" href="scala-play-new-relic.html#1.-new-relic%E3%81%AE%E6%83%85%E5%A0%B1%E3%82%92%E5%85%A5%E6%89%8B" rel="nofollow"><./a> 1. New Relicの情報を入手<./h1>
<p>New Relicのコンソールにある<code>+ Add more data<./code>ボタンをクリックして、いくつかある種類の中からとりあえず<code>App monitoring<./code>にある<code>Java<./code>を選んでおく。<./p>
<ul>
<li><img src="https:/./storage.googleapis.com./zenn-user-upload./zcl8nd7u7m3h6lqlybqeetpwyvz0" alt=""><./li>
<li><img src="https:/./storage.googleapis.com./zenn-user-upload./nc0nsj6l1yzoflt9dy82e9q9idid" alt=""><./li>
<./ul>
<p>そのあと色々入力していくと、下記のようにNew Relicのライセンス情報をダウンロードできるようになる。この内容を後の設定で利用するため<code>newrelic.yml<./code>をダウンロードしておく。<./p>
<p><img src="https:/./storage.googleapis.com./zenn-user-upload./886p1lioqbywhr3e11igrhmazgic" alt=""><./p>
<h1 id="2.-build.sbt%E3%81%A8project%2Fplugins.sbt%E3%81%AE%E8%A8%AD%E5%AE%9A"><a class="header-anchor-link" href="scala-play-new-relic.html#2.-build.sbt%E3%81%A8project%2Fplugins.sbt%E3%81%AE%E8%A8%AD%E5%AE%9A" rel="nofollow"><./a> 2. <code>build.sbt<./code>と<code>project./plugins.sbt<./code>の設定<./h1>
<p>まず<code>project./plugins.sbt<./code>に下記のように<a href="https:/./github.com./sbt./sbt-javaagent" rel="nofollow">sbt-javaagent<./a>のプラグインを追加する<sup class="footnote-ref"><a href="scala-play-new-relic.html#fn1" id="fnref1">[1]<./a><./sup>。<./p>

      <div class="code-block-container">
        <div class="code-block-filename-container"><span class="code-block-filename">project./plugins.sbt<./span><./div>
        <pre class="language-scala"><code class="language-scala">addSbtPlugin<span class="token punctuation">(<./span><span class="token string">"com.heroku"<./span> <span class="token operator">%<./span> <span class="token string">"sbt-heroku"<./span> <span class="token operator">%<./span> <span class="token string">"2.1.4"<./span><span class="token punctuation">)<./span>

addSbtPlugin<span class="token punctuation">(<./span><span class="token string">"com.lightbend.sbt"<./span> <span class="token operator">%<./span> <span class="token string">"sbt-javaagent"<./span> <span class="token operator">%<./span> <span class="token string">"0.1.6"<./span><span class="token punctuation">)<./span>
<./code><./pre>

      <./div>
      <p>そのうえで、<code>build.sbt<./code>にNew Relicのエージェントを起動する設定を追加する<sup class="footnote-ref"><a href="scala-play-new-relic.html#fn2" id="fnref2">[2]<./a><./sup>。<./p>

      <div class="code-block-container">
        <div class="code-block-filename-container"><span class="code-block-filename">build.sbt<./span><./div>
        <pre class="language-scala"><code class="language-scala"><span class="token keyword">lazy<./span> <span class="token keyword">val<./span> root <span class="token operator">=<./span> project
  <span class="token punctuation">.<./span>in<span class="token punctuation">(<./span>file<span class="token punctuation">(<./span><span class="token string">"."<./span><span class="token punctuation">)<./span><span class="token punctuation">)<./span>
  <span class="token punctuation">.<./span>settings<span class="token punctuation">(<./span>
    javaAgents <span class="token operator">+=<./span> <span class="token string">"com.newrelic.agent.java"<./span> <span class="token operator">%<./span> <span class="token string">"newrelic-agent"<./span> <span class="token operator">%<./span> <span class="token string">"6.5.0"<./span>
  <span class="token punctuation">)<./span>
  <span class="token punctuation">.<./span>enablePlugins<span class="token punctuation">(<./span>PlayScala<span class="token punctuation">,<./span> JavaAgent<span class="token punctuation">,<./span> JavaAppPackaging<span class="token punctuation">)<./span>
<./code><./pre>

      <./div>
      <p>このように<code>settings<./code>に<code>newrelic-agent<./code>を追加を追加すればOKである。<./p>
<h1 id="3.-heroku%E3%81%AE%E7%92%B0%E5%A2%83%E5%A4%89%E6%95%B0%E3%82%92%E8%BF%BD%E5%8A%A0"><a class="header-anchor-link" href="scala-play-new-relic.html#3.-heroku%E3%81%AE%E7%92%B0%E5%A2%83%E5%A4%89%E6%95%B0%E3%82%92%E8%BF%BD%E5%8A%A0" rel="nofollow"><./a> 3. Herokuの環境変数を追加<./h1>
<p>これですでにScala + PlayのWebアプリケーションはNew Relicエージェントが起動する状態ではあるが、ライセンス情報などが設定されていないため、起動させると必要な情報がないとなって即落ちてしまう。そこで手順（1）で入手した<code>newrelic.yml<./code>の冒頭は次のようになっている。<./p>

      <div class="code-block-container">
        <div class="code-block-filename-container"><span class="code-block-filename">newrelic.yml<./span><./div>
        <pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">common<./span><span class="token punctuation">:<./span> <span class="token important">&amp;default_settings<./span>

  <span class="token comment"># ============================== LICENSE KEY ===============================<./span>
  <span class="token comment"># You must specify the license key associated with your New Relic<./span>
  <span class="token comment"># account. For example, if your license key is 12345 use this:<./span>
  <span class="token comment"># license_key: '12345'<./span>
  <span class="token comment"># The key binds your Agent's data to your account in the New Relic service.<./span>
  <span class="token key atrule">license_key<./span><span class="token punctuation">:<./span> XXXXXXXXXXXXXXXXXXXXXXXXXX

  <span class="token comment"># Agent Enabled<./span>
  <span class="token comment"># Use this setting to disable the agent instead of removing it from the startup command.<./span>
  <span class="token comment"># Default is true.<./span>
  <span class="token key atrule">agent_enabled<./span><span class="token punctuation">:<./span> <span class="token boolean important">true<./span>

  <span class="token comment"># Set the name of your application as you'd like it show up in New Relic.<./span>
  <span class="token comment"># If enable_auto_app_naming is false, the agent reports all data to this application.<./span>
  <span class="token comment"># Otherwise, the agent reports only background tasks (transactions for non-web applications)<./span>
  <span class="token comment"># to this application. To report data to more than one application<./span>
  <span class="token comment"># (useful for rollup reporting), separate the application names with ";".<./span>
  <span class="token comment"># For example, to report data to "My Application" and "My Application 2" use this:<./span>
  <span class="token comment"># app_name: My Application;My Application 2<./span>
  <span class="token comment"># This setting is required. Up to 3 different application names can be specified.<./span>
  <span class="token comment"># The first application name must be unique.<./span>
  <span class="token key atrule">app_name<./span><span class="token punctuation">:<./span> kindle<span class="token punctuation">-<./span>clock
<./code><./pre>

      <./div>
      <p>重要なのはこの中の<code>common.license_key<./code>と<code>common.app_name<./code>の2つである。この2つを次のようにHerokuの環境変数に設定する。<./p>
<ul>
<li><code>NEW_RELIC_APP_NAME<./code> …… <code>common.app_name<./code><./li>
<li><code>NEW_RELIC_LICENSE_KEY<./code> …… <code>common.license_key<./code><./li>
<./ul>
<p><img src="https:/./storage.googleapis.com./zenn-user-upload./i07qddcp6fexnxwjbrh8kexcy67j" alt=""><./p>
<p>ちなみにこれらの環境変数を読み込む設定はNew Relicエージェントに元々搭載されているので、こちらで何か実装する必要はない。<./p>
<h1 id="4.-heroku%E3%81%B8%E3%81%AE%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4"><a class="header-anchor-link" href="scala-play-new-relic.html#4.-heroku%E3%81%B8%E3%81%AE%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4" rel="nofollow"><./a> 4. Herokuへのデプロイ<./h1>
<p>ここまで行えばあとは<code>sbt-heroku<./code>を利用していれば簡単である。下記のコマンドを実行すればよい。<./p>

      <div class="code-block-container">
        
        <pre class="language-console"><code class="language-console">$ sbt stage deployHeroku
<./code><./pre>

      <./div>
      <h1 id="%E3%81%BE%E3%81%A8%E3%82%81"><a class="header-anchor-link" href="scala-play-new-relic.html#%E3%81%BE%E3%81%A8%E3%82%81" rel="nofollow"><./a> まとめ<./h1>
<p>このように<code>sbt-javaagent<./code>を利用すればJAR（ZIPファイル）を展開してYAMLファイルを注入するといった、ややダーティーな方法を回避しつつScala + PlayなWebアプリでNew Relicを利用することができる。この方法であれば、たとえば<a href="https:/./github.com./scala-steward-org./scala-steward" rel="nofollow">Scala Steward<./a>による自動ライブラリーアップデートPull Request作成機能の恩恵を受けやすいと考えられる。<./p>
<section class="footnotes">
<div class="footnotes-title"><img src="https:/./twemoji.maxcdn.com./2./svg./1f58b.svg" class="emoji footnotes-twemoji" loading="lazy" width="20" height="20">脚注<./div>
<ol class="footnotes-list">
<li id="fn1" class="footnote-item"><p>この記事がHerokuを前提としているため、デプロイには<a href="https:/./github.com./heroku./sbt-heroku" rel="nofollow">sbt-heroku<./a>を利用しているということで進めている。筆者はこのようにしたが、おそらく必ずしも<code>sbt-heroku<./code>を利用する必要はないと思われる。 <a href="scala-play-new-relic.html#fnref1" class="footnote-backref">↩︎<./a><./p>
<./li>
<li id="fn2" class="footnote-item"><p>ここでも記事の前提としてPlayframeworkを利用しているので、<code>enablePlugins<./code>でこれをONにしている。 <a href="scala-play-new-relic.html#fnref2" class="footnote-backref">↩︎<./a><./p>
<./li>
<./ol>
<./section>
<./div><./div><./div><./div><./article><./main><./div><./div><script id="__NEXT_DATA__" type="application./json">{"props":{"pageProps":{"article":{"slug":"scala-play-new-relic","content":"\u003ch1 id=\"%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ca class=\"header-anchor-link\" href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\" rel=\"nofollow\"\u003e\u003c./a\u003e はじめに\u003c./h1\u003e\n\u003cp\u003e\u003ca href=\"https:/./www.heroku.com/\" rel=\"nofollow\"\u003eHeroku\u003c./a\u003eの無料（Hobby）範囲内で\u003ca href=\"https:/./newrelic.com/\" rel=\"nofollow\"\u003eNew Relic\u003c./a\u003eを無料で利用することができる。New Relicはアプリケーションのモニタリングツールであり、メモリ量やGCのことや外部APIアクセスのレスポンスタイムなど様々なデータをモニターすることができる。下記のようにグラフィカルな表示もしてくれる。\u003c./p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cimg src=\"https:/./storage.googleapis.com./zenn-user-upload./bj6lp9yck5kdimaywa4bl9eoxxri\" alt=\"\"\u003e\u003c./li\u003e\n\u003cli\u003e\u003cimg src=\"https:/./storage.googleapis.com./zenn-user-upload./mi2nwn2b7kdwbue90c0kfzphv0gi\" alt=\"\"\u003e\u003c./li\u003e\n\u003c./ul\u003e\n\u003cp\u003e\u003ca href=\"https:/./docs.newrelic.com./docs./agents./java-agent./installation./include-java-agent-jvm-argument/#Installing_on_Play\" rel=\"nofollow\"\u003eNew Relicの公式のドキュメント\u003c./a\u003eにはJARファイルをいったんZIP展開したうえで、そこにYAMLファイルを設置して再びJARに戻すといった手順が紹介されているが、実はそのようなことをしなくても\u003ccode\u003ebuild.sbt\u003c./code\u003eなどへの記述 + 環境変数の追加だけで導入することができる。この記事ではHerokuを前提にNew Relicをどのように導入するかについて解説する。\u003cbr\u003e\nこの記事で紹介したコードを利用したプログラムが下記のリポジトリーに設置されている。\u003c./p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https:/./github.com./y-yu./kindle-clock\" rel=\"nofollow\"\u003ehttps:/./github.com./y-yu./kindle-clock\u003c./a\u003e\u003c./li\u003e\n\u003c./ul\u003e\n\u003ch1 id=\"1.-new-relic%E3%81%AE%E6%83%85%E5%A0%B1%E3%82%92%E5%85%A5%E6%89%8B\"\u003e\u003ca class=\"header-anchor-link\" href=\"#1.-new-relic%E3%81%AE%E6%83%85%E5%A0%B1%E3%82%92%E5%85%A5%E6%89%8B\" rel=\"nofollow\"\u003e\u003c./a\u003e 1. New Relicの情報を入手\u003c./h1\u003e\n\u003cp\u003eNew Relicのコンソールにある\u003ccode\u003e+ Add more data\u003c./code\u003eボタンをクリックして、いくつかある種類の中からとりあえず\u003ccode\u003eApp monitoring\u003c./code\u003eにある\u003ccode\u003eJava\u003c./code\u003eを選んでおく。\u003c./p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cimg src=\"https:/./storage.googleapis.com./zenn-user-upload./zcl8nd7u7m3h6lqlybqeetpwyvz0\" alt=\"\"\u003e\u003c./li\u003e\n\u003cli\u003e\u003cimg src=\"https:/./storage.googleapis.com./zenn-user-upload./nc0nsj6l1yzoflt9dy82e9q9idid\" alt=\"\"\u003e\u003c./li\u003e\n\u003c./ul\u003e\n\u003cp\u003eそのあと色々入力していくと、下記のようにNew Relicのライセンス情報をダウンロードできるようになる。この内容を後の設定で利用するため\u003ccode\u003enewrelic.yml\u003c./code\u003eをダウンロードしておく。\u003c./p\u003e\n\u003cp\u003e\u003cimg src=\"https:/./storage.googleapis.com./zenn-user-upload./886p1lioqbywhr3e11igrhmazgic\" alt=\"\"\u003e\u003c./p\u003e\n\u003ch1 id=\"2.-build.sbt%E3%81%A8project%2Fplugins.sbt%E3%81%AE%E8%A8%AD%E5%AE%9A\"\u003e\u003ca class=\"header-anchor-link\" href=\"#2.-build.sbt%E3%81%A8project%2Fplugins.sbt%E3%81%AE%E8%A8%AD%E5%AE%9A\" rel=\"nofollow\"\u003e\u003c./a\u003e 2. \u003ccode\u003ebuild.sbt\u003c./code\u003eと\u003ccode\u003eproject./plugins.sbt\u003c./code\u003eの設定\u003c./h1\u003e\n\u003cp\u003eまず\u003ccode\u003eproject./plugins.sbt\u003c./code\u003eに下記のように\u003ca href=\"https:/./github.com./sbt./sbt-javaagent\" rel=\"nofollow\"\u003esbt-javaagent\u003c./a\u003eのプラグインを追加する\u003csup class=\"footnote-ref\"\u003e\u003ca href=\"#fn1\" id=\"fnref1\"\u003e[1]\u003c./a\u003e\u003c./sup\u003e。\u003c./p\u003e\n\n      \u003cdiv class=\"code-block-container\"\u003e\n        \u003cdiv class=\"code-block-filename-container\"\u003e\u003cspan class=\"code-block-filename\"\u003eproject./plugins.sbt\u003c./span\u003e\u003c./div\u003e\n        \u003cpre class=\"language-scala\"\u003e\u003ccode class=\"language-scala\"\u003eaddSbtPlugin\u003cspan class=\"token punctuation\"\u003e(\u003c./span\u003e\u003cspan class=\"token string\"\u003e\"com.heroku\"\u003c./span\u003e \u003cspan class=\"token operator\"\u003e%\u003c./span\u003e \u003cspan class=\"token string\"\u003e\"sbt-heroku\"\u003c./span\u003e \u003cspan class=\"token operator\"\u003e%\u003c./span\u003e \u003cspan class=\"token string\"\u003e\"2.1.4\"\u003c./span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c./span\u003e\n\naddSbtPlugin\u003cspan class=\"token punctuation\"\u003e(\u003c./span\u003e\u003cspan class=\"token string\"\u003e\"com.lightbend.sbt\"\u003c./span\u003e \u003cspan class=\"token operator\"\u003e%\u003c./span\u003e \u003cspan class=\"token string\"\u003e\"sbt-javaagent\"\u003c./span\u003e \u003cspan class=\"token operator\"\u003e%\u003c./span\u003e \u003cspan class=\"token string\"\u003e\"0.1.6\"\u003c./span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c./span\u003e\n\u003c./code\u003e\u003c./pre\u003e\n\n      \u003c./div\u003e\n      \u003cp\u003eそのうえで、\u003ccode\u003ebuild.sbt\u003c./code\u003eにNew Relicのエージェントを起動する設定を追加する\u003csup class=\"footnote-ref\"\u003e\u003ca href=\"#fn2\" id=\"fnref2\"\u003e[2]\u003c./a\u003e\u003c./sup\u003e。\u003c./p\u003e\n\n      \u003cdiv class=\"code-block-container\"\u003e\n        \u003cdiv class=\"code-block-filename-container\"\u003e\u003cspan class=\"code-block-filename\"\u003ebuild.sbt\u003c./span\u003e\u003c./div\u003e\n        \u003cpre class=\"language-scala\"\u003e\u003ccode class=\"language-scala\"\u003e\u003cspan class=\"token keyword\"\u003elazy\u003c./span\u003e \u003cspan class=\"token keyword\"\u003eval\u003c./span\u003e root \u003cspan class=\"token operator\"\u003e=\u003c./span\u003e project\n  \u003cspan class=\"token punctuation\"\u003e.\u003c./span\u003ein\u003cspan class=\"token punctuation\"\u003e(\u003c./span\u003efile\u003cspan class=\"token punctuation\"\u003e(\u003c./span\u003e\u003cspan class=\"token string\"\u003e\".\"\u003c./span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c./span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c./span\u003e\n  \u003cspan class=\"token punctuation\"\u003e.\u003c./span\u003esettings\u003cspan class=\"token punctuation\"\u003e(\u003c./span\u003e\n    javaAgents \u003cspan class=\"token operator\"\u003e+=\u003c./span\u003e \u003cspan class=\"token string\"\u003e\"com.newrelic.agent.java\"\u003c./span\u003e \u003cspan class=\"token operator\"\u003e%\u003c./span\u003e \u003cspan class=\"token string\"\u003e\"newrelic-agent\"\u003c./span\u003e \u003cspan class=\"token operator\"\u003e%\u003c./span\u003e \u003cspan class=\"token string\"\u003e\"6.5.0\"\u003c./span\u003e\n  \u003cspan class=\"token punctuation\"\u003e)\u003c./span\u003e\n  \u003cspan class=\"token punctuation\"\u003e.\u003c./span\u003eenablePlugins\u003cspan class=\"token punctuation\"\u003e(\u003c./span\u003ePlayScala\u003cspan class=\"token punctuation\"\u003e,\u003c./span\u003e JavaAgent\u003cspan class=\"token punctuation\"\u003e,\u003c./span\u003e JavaAppPackaging\u003cspan class=\"token punctuation\"\u003e)\u003c./span\u003e\n\u003c./code\u003e\u003c./pre\u003e\n\n      \u003c./div\u003e\n      \u003cp\u003eこのように\u003ccode\u003esettings\u003c./code\u003eに\u003ccode\u003enewrelic-agent\u003c./code\u003eを追加を追加すればOKである。\u003c./p\u003e\n\u003ch1 id=\"3.-heroku%E3%81%AE%E7%92%B0%E5%A2%83%E5%A4%89%E6%95%B0%E3%82%92%E8%BF%BD%E5%8A%A0\"\u003e\u003ca class=\"header-anchor-link\" href=\"#3.-heroku%E3%81%AE%E7%92%B0%E5%A2%83%E5%A4%89%E6%95%B0%E3%82%92%E8%BF%BD%E5%8A%A0\" rel=\"nofollow\"\u003e\u003c./a\u003e 3. Herokuの環境変数を追加\u003c./h1\u003e\n\u003cp\u003eこれですでにScala + PlayのWebアプリケーションはNew Relicエージェントが起動する状態ではあるが、ライセンス情報などが設定されていないため、起動させると必要な情報がないとなって即落ちてしまう。そこで手順（1）で入手した\u003ccode\u003enewrelic.yml\u003c./code\u003eの冒頭は次のようになっている。\u003c./p\u003e\n\n      \u003cdiv class=\"code-block-container\"\u003e\n        \u003cdiv class=\"code-block-filename-container\"\u003e\u003cspan class=\"code-block-filename\"\u003enewrelic.yml\u003c./span\u003e\u003c./div\u003e\n        \u003cpre class=\"language-yaml\"\u003e\u003ccode class=\"language-yaml\"\u003e\u003cspan class=\"token key atrule\"\u003ecommon\u003c./span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c./span\u003e \u003cspan class=\"token important\"\u003e\u0026amp;default_settings\u003c./span\u003e\n\n  \u003cspan class=\"token comment\"\u003e# ============================== LICENSE KEY ===============================\u003c./span\u003e\n  \u003cspan class=\"token comment\"\u003e# You must specify the license key associated with your New Relic\u003c./span\u003e\n  \u003cspan class=\"token comment\"\u003e# account. For example, if your license key is 12345 use this:\u003c./span\u003e\n  \u003cspan class=\"token comment\"\u003e# license_key: '12345'\u003c./span\u003e\n  \u003cspan class=\"token comment\"\u003e# The key binds your Agent's data to your account in the New Relic service.\u003c./span\u003e\n  \u003cspan class=\"token key atrule\"\u003elicense_key\u003c./span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c./span\u003e XXXXXXXXXXXXXXXXXXXXXXXXXX\n\n  \u003cspan class=\"token comment\"\u003e# Agent Enabled\u003c./span\u003e\n  \u003cspan class=\"token comment\"\u003e# Use this setting to disable the agent instead of removing it from the startup command.\u003c./span\u003e\n  \u003cspan class=\"token comment\"\u003e# Default is true.\u003c./span\u003e\n  \u003cspan class=\"token key atrule\"\u003eagent_enabled\u003c./span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c./span\u003e \u003cspan class=\"token boolean important\"\u003etrue\u003c./span\u003e\n\n  \u003cspan class=\"token comment\"\u003e# Set the name of your application as you'd like it show up in New Relic.\u003c./span\u003e\n  \u003cspan class=\"token comment\"\u003e# If enable_auto_app_naming is false, the agent reports all data to this application.\u003c./span\u003e\n  \u003cspan class=\"token comment\"\u003e# Otherwise, the agent reports only background tasks (transactions for non-web applications)\u003c./span\u003e\n  \u003cspan class=\"token comment\"\u003e# to this application. To report data to more than one application\u003c./span\u003e\n  \u003cspan class=\"token comment\"\u003e# (useful for rollup reporting), separate the application names with \";\".\u003c./span\u003e\n  \u003cspan class=\"token comment\"\u003e# For example, to report data to \"My Application\" and \"My Application 2\" use this:\u003c./span\u003e\n  \u003cspan class=\"token comment\"\u003e# app_name: My Application;My Application 2\u003c./span\u003e\n  \u003cspan class=\"token comment\"\u003e# This setting is required. Up to 3 different application names can be specified.\u003c./span\u003e\n  \u003cspan class=\"token comment\"\u003e# The first application name must be unique.\u003c./span\u003e\n  \u003cspan class=\"token key atrule\"\u003eapp_name\u003c./span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c./span\u003e kindle\u003cspan class=\"token punctuation\"\u003e-\u003c./span\u003eclock\n\u003c./code\u003e\u003c./pre\u003e\n\n      \u003c./div\u003e\n      \u003cp\u003e重要なのはこの中の\u003ccode\u003ecommon.license_key\u003c./code\u003eと\u003ccode\u003ecommon.app_name\u003c./code\u003eの2つである。この2つを次のようにHerokuの環境変数に設定する。\u003c./p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eNEW_RELIC_APP_NAME\u003c./code\u003e …… \u003ccode\u003ecommon.app_name\u003c./code\u003e\u003c./li\u003e\n\u003cli\u003e\u003ccode\u003eNEW_RELIC_LICENSE_KEY\u003c./code\u003e …… \u003ccode\u003ecommon.license_key\u003c./code\u003e\u003c./li\u003e\n\u003c./ul\u003e\n\u003cp\u003e\u003cimg src=\"https:/./storage.googleapis.com./zenn-user-upload./i07qddcp6fexnxwjbrh8kexcy67j\" alt=\"\"\u003e\u003c./p\u003e\n\u003cp\u003eちなみにこれらの環境変数を読み込む設定はNew Relicエージェントに元々搭載されているので、こちらで何か実装する必要はない。\u003c./p\u003e\n\u003ch1 id=\"4.-heroku%E3%81%B8%E3%81%AE%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4\"\u003e\u003ca class=\"header-anchor-link\" href=\"#4.-heroku%E3%81%B8%E3%81%AE%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4\" rel=\"nofollow\"\u003e\u003c./a\u003e 4. Herokuへのデプロイ\u003c./h1\u003e\n\u003cp\u003eここまで行えばあとは\u003ccode\u003esbt-heroku\u003c./code\u003eを利用していれば簡単である。下記のコマンドを実行すればよい。\u003c./p\u003e\n\n      \u003cdiv class=\"code-block-container\"\u003e\n        \n        \u003cpre class=\"language-console\"\u003e\u003ccode class=\"language-console\"\u003e$ sbt stage deployHeroku\n\u003c./code\u003e\u003c./pre\u003e\n\n      \u003c./div\u003e\n      \u003ch1 id=\"%E3%81%BE%E3%81%A8%E3%82%81\"\u003e\u003ca class=\"header-anchor-link\" href=\"#%E3%81%BE%E3%81%A8%E3%82%81\" rel=\"nofollow\"\u003e\u003c./a\u003e まとめ\u003c./h1\u003e\n\u003cp\u003eこのように\u003ccode\u003esbt-javaagent\u003c./code\u003eを利用すればJAR（ZIPファイル）を展開してYAMLファイルを注入するといった、ややダーティーな方法を回避しつつScala + PlayなWebアプリでNew Relicを利用することができる。この方法であれば、たとえば\u003ca href=\"https:/./github.com./scala-steward-org./scala-steward\" rel=\"nofollow\"\u003eScala Steward\u003c./a\u003eによる自動ライブラリーアップデートPull Request作成機能の恩恵を受けやすいと考えられる。\u003c./p\u003e\n\u003csection class=\"footnotes\"\u003e\n\u003cdiv class=\"footnotes-title\"\u003e\u003cimg src=\"https:/./twemoji.maxcdn.com./2./svg./1f58b.svg\" class=\"emoji footnotes-twemoji\" loading=\"lazy\" width=\"20\" height=\"20\"\u003e脚注\u003c./div\u003e\n\u003col class=\"footnotes-list\"\u003e\n\u003cli id=\"fn1\" class=\"footnote-item\"\u003e\u003cp\u003eこの記事がHerokuを前提としているため、デプロイには\u003ca href=\"https:/./github.com./heroku./sbt-heroku\" rel=\"nofollow\"\u003esbt-heroku\u003c./a\u003eを利用しているということで進めている。筆者はこのようにしたが、おそらく必ずしも\u003ccode\u003esbt-heroku\u003c./code\u003eを利用する必要はないと思われる。 \u003ca href=\"#fnref1\" class=\"footnote-backref\"\u003e↩︎\u003c./a\u003e\u003c./p\u003e\n\u003c./li\u003e\n\u003cli id=\"fn2\" class=\"footnote-item\"\u003e\u003cp\u003eここでも記事の前提としてPlayframeworkを利用しているので、\u003ccode\u003eenablePlugins\u003c./code\u003eでこれをONにしている。 \u003ca href=\"#fnref2\" class=\"footnote-backref\"\u003e↩︎\u003c./a\u003e\u003c./p\u003e\n\u003c./li\u003e\n\u003c./ol\u003e\n\u003c./section\u003e\n","title":"Scala + Play on HerokuなWebアプリにNew Relicを導入","emoji":"📈","type":"tech","topics":["scala","playframework","newrelic","heroku"],"published":true},"allContentsNavCollections":[{"name":"articles","items":[{"name":"🏹 \u003cspan class=\"draft\"\u003e下書き\u003c./span\u003eSwift Bow Archの入門","href":"./articles/[slug]","as":"./articles./268447da9fb103"},{"name":"📄 Zennの記事をGitHub Pagesで無理やり表示する","href":"./articles/[slug]","as":"./articles./54134d8df9f9b5385fc3"},{"name":"🙈 \u003cspan class=\"draft\"\u003e下書き\u003c./span\u003e量子コンピュータで“Covert”⁉️なガチャ","href":"./articles/[slug]","as":"./articles./79c6c48226166aa0e875"},{"name":"📈 Scala + Play on HerokuなWebアプリにNew Relicを導入","href":"./articles/[slug]","as":"./articles./scala-play-new-relic"}]},{"name":"books","items":[{"name":"✨ 最初の本を作成しましょう","href":"/"}]}]},"__N_SSP":true},"page":"./articles/[slug]","query":{"slug":"scala-play-new-relic"},"buildId":"Iw9_T9HmY8-P8OB-CVWN1","isFallback":false,"gssp":true,"customServer":true}<./script><script nomodule="" src="../_next./static./chunks./polyfills-bc93924a219b603c3b70.js"><./script><script src="../_next./static./chunks./main-1b66b3d4e760501de7fc.js" async=""><./script><script src="../_next./static./chunks./webpack-101b4f64d52887b5db9b.js" async=""><./script><script src="../_next./static./chunks./framework.c81d3c1a1154ef2f0a4c.js" async=""><./script><script src="../_next./static./chunks./commons.1d17d07e0ebe7c16f5b5.js" async=""><./script><script src="../_next./static./chunks./pages./_app-b342a0da64871712e09b.js" async=""><./script><script src="../_next./static./chunks./7ea9eb72fe501167df0c2d045178d60d280aa121.549ac0d8bdc0604fb58b.js" async=""><./script><script src="../_next./static./chunks./fac796102cd92fcc9d69418a1184140a0c3193c8.fee5f3964bb5b2c71f69.js" async=""><./script><script src="../_next./static./chunks./pages./articles/[slug]-ed1dc9d6a24fac085414.js" async=""><./script><script src="../_next./static./Iw9_T9HmY8-P8OB-CVWN1./_buildManifest.js" async=""><./script><script src="../_next./static./Iw9_T9HmY8-P8OB-CVWN1./_ssgManifest.js" async=""><./script><./body><./html>